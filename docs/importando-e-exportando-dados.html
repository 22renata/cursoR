<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Curso de R para Meteorologia IAG/USP</title>
  <meta name="description" content="Este é um curso de R para Meteorologia. O curso tenta ser abrangente, desde interessados sem formação, passando por graduação e pós-graduação">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Curso de R para Meteorologia IAG/USP" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Este é um curso de R para Meteorologia. O curso tenta ser abrangente, desde interessados sem formação, passando por graduação e pós-graduação" />
  <meta name="github-repo" content="iagdevs/cursoR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Curso de R para Meteorologia IAG/USP" />
  
  <meta name="twitter:description" content="Este é um curso de R para Meteorologia. O curso tenta ser abrangente, desde interessados sem formação, passando por graduação e pós-graduação" />
  

<meta name="author" content="Sergio Ibarra-Espinosa, Amanda Rehbein, Daniel Schuch, Camila Lopes, Isabela Siqueira, e possivelmente outros (você está convidado para colaborar)">


<meta name="date" content="2018-06-04">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="r.html">
<link rel="next" href="plotando.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Curso R DCA/IAG/USP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Pré-Requisitos</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#sistema-operacional"><i class="fa fa-check"></i><b>1.1</b> Sistema Operacional</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#pacotes-usados-neste-curso"><i class="fa fa-check"></i><b>1.2</b> Pacotes usados neste curso</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#dados-usados-neste-curso"><i class="fa fa-check"></i><b>1.3</b> Dados usados neste curso</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#colaborar"><i class="fa fa-check"></i><b>1.4</b> Colaborar</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#compartilhar-dados"><i class="fa fa-check"></i><b>1.5</b> Compartilhar dados</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Intro</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#importante"><i class="fa fa-check"></i><b>2.1</b> IMPORTANTE</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r.html"><a href="r.html"><i class="fa fa-check"></i><b>3</b> R!</a><ul>
<li class="chapter" data-level="3.1" data-path="r.html"><a href="r.html#variaveis-basicas"><i class="fa fa-check"></i><b>3.1</b> Variáveis Básicas</a></li>
<li class="chapter" data-level="3.2" data-path="r.html"><a href="r.html#vetores"><i class="fa fa-check"></i><b>3.2</b> Vetores</a></li>
<li class="chapter" data-level="3.3" data-path="r.html"><a href="r.html#classe"><i class="fa fa-check"></i><b>3.3</b> Classe</a></li>
<li class="chapter" data-level="3.4" data-path="r.html"><a href="r.html#converter-objetos"><i class="fa fa-check"></i><b>3.4</b> Converter objetos</a><ul>
<li class="chapter" data-level="3.4.1" data-path="r.html"><a href="r.html#as"><i class="fa fa-check"></i><b>3.4.1</b> <code>as</code></a></li>
<li class="chapter" data-level="3.4.2" data-path="r.html"><a href="r.html#convert_df"><i class="fa fa-check"></i><b>3.4.2</b> <code>merge</code> e <code>melt</code></a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="r.html"><a href="r.html#array"><i class="fa fa-check"></i><b>3.5</b> Array</a></li>
<li class="chapter" data-level="3.6" data-path="r.html"><a href="r.html#matrizes-e-a-funcao-matrix"><i class="fa fa-check"></i><b>3.6</b> Matrizes e a função <code>matrix</code></a></li>
<li class="chapter" data-level="3.7" data-path="r.html"><a href="r.html#listas"><i class="fa fa-check"></i><b>3.7</b> Listas</a></li>
<li class="chapter" data-level="3.8" data-path="r.html"><a href="r.html#dataframes"><i class="fa fa-check"></i><b>3.8</b> Data Frames</a></li>
<li class="chapter" data-level="3.9" data-path="r.html"><a href="r.html#tempo-e-data"><i class="fa fa-check"></i><b>3.9</b> Tempo e Data</a></li>
<li class="chapter" data-level="3.10" data-path="r.html"><a href="r.html#fatores"><i class="fa fa-check"></i><b>3.10</b> Fatores</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html"><i class="fa fa-check"></i><b>4</b> Importando e Exportando Dados</a><ul>
<li class="chapter" data-level="4.1" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#base"><i class="fa fa-check"></i><b>4.1</b> Base</a><ul>
<li class="chapter" data-level="4.1.1" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#importando-com-read."><i class="fa fa-check"></i><b>4.1.1</b> Importando com <code>read.*</code></a></li>
<li class="chapter" data-level="4.1.2" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#exportando-texto-com-write.table"><i class="fa fa-check"></i><b>4.1.2</b> Exportando texto com <code>write.table</code></a></li>
<li class="chapter" data-level="4.1.3" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#exportando-objetos-com-save"><i class="fa fa-check"></i><b>4.1.3</b> Exportando objetos com <code>save</code></a></li>
<li class="chapter" data-level="4.1.4" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#exportando-objetos-com-saverds"><i class="fa fa-check"></i><b>4.1.4</b> Exportando objetos com <code>saveRDS</code></a></li>
<li class="chapter" data-level="4.1.5" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#processing_dfs"><i class="fa fa-check"></i><b>4.1.5</b> Processando nossa data-frame</a></li>
<li class="chapter" data-level="4.1.6" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#data.table-e-mais"><i class="fa fa-check"></i><b>4.1.6</b> Data.table e mais</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#tidyverse"><i class="fa fa-check"></i><b>4.2</b> Tidyverse</a><ul>
<li class="chapter" data-level="4.2.1" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#importando-dados"><i class="fa fa-check"></i><b>4.2.1</b> Importando dados</a></li>
<li class="chapter" data-level="4.2.2" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#leitura-processamento"><i class="fa fa-check"></i><b>4.2.2</b> Leitura <code>%&gt;%</code> Processamento</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#outros-tipos-de-dados"><i class="fa fa-check"></i><b>4.3</b> Outros Tipos de Dados</a><ul>
<li class="chapter" data-level="4.3.1" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#netcdf"><i class="fa fa-check"></i><b>4.3.1</b> NetCDF</a></li>
<li class="chapter" data-level="4.3.2" data-path="importando-e-exportando-dados.html"><a href="importando-e-exportando-dados.html#dados-binarios"><i class="fa fa-check"></i><b>4.3.2</b> Dados Binários</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="plotando.html"><a href="plotando.html"><i class="fa fa-check"></i><b>5</b> Plotando</a><ul>
<li class="chapter" data-level="5.1" data-path="plotando.html"><a href="plotando.html#plot-base"><i class="fa fa-check"></i><b>5.1</b> <code>plot</code> (base)</a></li>
<li class="chapter" data-level="5.2" data-path="plotando.html"><a href="plotando.html#ggplot-ggplot2"><i class="fa fa-check"></i><b>5.2</b> <code>ggplot</code> (ggplot2)</a><ul>
<li class="chapter" data-level="5.2.1" data-path="plotando.html"><a href="plotando.html#explorando-outras-escalas-de-cores-e-temas"><i class="fa fa-check"></i><b>5.2.1</b> Explorando outras escalas de cores e temas</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="loop.html"><a href="loop.html"><i class="fa fa-check"></i><b>6</b> Estruturas de Controle</a><ul>
<li class="chapter" data-level="6.1" data-path="loop.html"><a href="loop.html#if-else"><i class="fa fa-check"></i><b>6.1</b> if-else</a></li>
<li class="chapter" data-level="6.2" data-path="loop.html"><a href="loop.html#for"><i class="fa fa-check"></i><b>6.2</b> for</a></li>
<li class="chapter" data-level="6.3" data-path="loop.html"><a href="loop.html#while"><i class="fa fa-check"></i><b>6.3</b> while</a></li>
<li class="chapter" data-level="6.4" data-path="loop.html"><a href="loop.html#repeat"><i class="fa fa-check"></i><b>6.4</b> repeat</a></li>
<li class="chapter" data-level="6.5" data-path="loop.html"><a href="loop.html#lapply"><i class="fa fa-check"></i><b>6.5</b> lapply</a></li>
<li class="chapter" data-level="6.6" data-path="loop.html"><a href="loop.html#sapply"><i class="fa fa-check"></i><b>6.6</b> sapply</a></li>
<li class="chapter" data-level="6.7" data-path="loop.html"><a href="loop.html#split"><i class="fa fa-check"></i><b>6.7</b> split</a></li>
<li class="chapter" data-level="6.8" data-path="loop.html"><a href="loop.html#tapply"><i class="fa fa-check"></i><b>6.8</b> tapply</a></li>
<li class="chapter" data-level="6.9" data-path="loop.html"><a href="loop.html#apply"><i class="fa fa-check"></i><b>6.9</b> apply</a></li>
<li class="chapter" data-level="6.10" data-path="loop.html"><a href="loop.html#mapply"><i class="fa fa-check"></i><b>6.10</b> mapply</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="fx.html"><a href="fx.html"><i class="fa fa-check"></i><b>7</b> De Scripts a Funções e de Funções a Pacotes</a></li>
<li class="chapter" data-level="8" data-path="geo.html"><a href="geo.html"><i class="fa fa-check"></i><b>8</b> Geo Spatial: <code>raster</code>, <code>sf</code> e <code>stars</code></a></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referências</a></li>
<li class="divider"></li>
<li><a href="https://iagdevs.github.io/cursoR" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Curso de R para Meteorologia IAG/USP</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="importando-e-exportando-dados" class="section level1">
<h1><span class="header-section-number">Capítulo 4</span> Importando e Exportando Dados</h1>
<div id="base" class="section level2">
<h2><span class="header-section-number">4.1</span> Base</h2>
<div id="importando-com-read." class="section level3">
<h3><span class="header-section-number">4.1.1</span> Importando com <code>read.*</code></h3>
<p>Como vimos anteriormente, na maioria dos casos, iremos usar data frames par lidar com dados em R, sendo assim, podemos utilizar os seguintes modos de leitura:</p>
<ul>
<li>read.csv</li>
<li>read.csv2</li>
<li>read.table</li>
</ul>
<p>Vamos ler alguns dados usando read.table, para saber o que a função faz, use <code>?read.table</code>. Os argumentos da função são:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">args</span>(read.table)</code></pre></div>
<pre><code>## function (file, header = FALSE, sep = &quot;&quot;, quote = &quot;\&quot;&#39;&quot;, dec = &quot;.&quot;, 
##     numerals = c(&quot;allow.loss&quot;, &quot;warn.loss&quot;, &quot;no.loss&quot;), row.names, 
##     col.names, as.is = !stringsAsFactors, na.strings = &quot;NA&quot;, 
##     colClasses = NA, nrows = -1, skip = 0, check.names = TRUE, 
##     fill = !blank.lines.skip, strip.white = FALSE, blank.lines.skip = TRUE, 
##     comment.char = &quot;#&quot;, allowEscapes = FALSE, flush = FALSE, 
##     stringsAsFactors = default.stringsAsFactors(), fileEncoding = &quot;&quot;, 
##     encoding = &quot;unknown&quot;, text, skipNul = FALSE) 
## NULL</code></pre>
<p>O terceiro argumento é sep, com valores por default = “”. Esse argumento indica para o R qual o tipo de separador utilizado entre as colunas dos dados.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;dados/NOXIPEN2014.txt&quot;</span>)</code></pre></div>
<p>Lembre-se que as funções head e tail permitem que você veja as primeiras ou últimas linhas do data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(df)</code></pre></div>
<pre><code>##   TipodeRede TipodeMonitoramento            Tipo       Data  Hora
## 2 Automático              CETESB Dados Primários 01/01/2014 01:00
## 3 Automático              CETESB Dados Primários 01/01/2014 02:00
## 4 Automático              CETESB Dados Primários 01/01/2014 03:00
## 5 Automático              CETESB Dados Primários 01/01/2014 04:00
## 6 Automático              CETESB Dados Primários 01/01/2014 05:00
## 7 Automático              CETESB Dados Primários 01/01/2014 06:00
##   CodigoEstação                NomeEstação              NomeParâmetro
## 2            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 3            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 4            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 5            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 6            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 7            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
##   UnidadedeMedida MediaHoraria MediaMovel Valido
## 2             ppb            9          -    Não
## 3             ppb            9          -    Sim
## 4             ppb            5          -    Sim
## 5             ppb            4          -    Sim
## 6             ppb            5          -    Sim
## 7             ppb            5          -    Sim</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(df)</code></pre></div>
<pre><code>##      TipodeRede TipodeMonitoramento            Tipo       Data  Hora
## 8577 Automático              CETESB Dados Primários 01/01/2015 19:00
## 8578 Automático              CETESB Dados Primários 01/01/2015 20:00
## 8579 Automático              CETESB Dados Primários 01/01/2015 21:00
## 8580 Automático              CETESB Dados Primários 01/01/2015 22:00
## 8581 Automático              CETESB Dados Primários 01/01/2015 23:00
## 8582 Automático              CETESB Dados Primários 01/01/2015 24:00
##      CodigoEstação                NomeEstação              NomeParâmetro
## 8577            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 8578            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 8579            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 8580            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 8581            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 8582            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
##      UnidadedeMedida MediaHoraria MediaMovel Valido
## 8577             ppb            3          -    Sim
## 8578             ppb            8          -    Sim
## 8579             ppb           11          -    Sim
## 8580             ppb           11          -    Sim
## 8581             ppb           16          -    Sim
## 8582             ppb           NA          -    Sim</code></pre>
<p>O que acontece se tentarmos ler os mesmo dados utilizando a função read.table?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df2 &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;dados/NOXIPEN2014v2.txt&quot;</span>)
<span class="co"># Error in scan(file = file, what = what, sep = sep, quote = quote, dec = dec, : </span>
<span class="co"># linha 1 não tinha 6 elementos</span></code></pre></div>
<p>Apareceu uma mensagem de erro, você saberia dizer o porquê?</p>
<p><strong>Caso você trabalhe com algum banco de dados em formato .txt e quiser abrir no R… Abra-os no bloco de notas primeiro</strong></p>
<p>Vamos dar uma olhada em alguns dados, o primeiro tem uma cara assim:</p>
<p><img src="figuras/f1.png" width="665" /></p>
<p>Já o segundo arquivo é assim:</p>
<p><img src="figuras/f2.png" width="552" /></p>
<p>Você notou a diferença? Como vimos anteriormente, para importar os dados no R é super importante que você especifique o tipo de separador utilizado, como o segundo arquivo tem separação de “;”, precisamos espercificar o argumento <code>sep</code> na hora de usar o comando <code>read.table</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df2 &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;dados/NOXIPEN2014v2.txt&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)
<span class="kw">head</span>(df2)</code></pre></div>
<pre><code>##   TipodeRede TipodeMonitoramento            Tipo       Data  Hora
## 2 Automático              CETESB Dados Primários 01/01/2014 01:00
## 3 Automático              CETESB Dados Primários 01/01/2014 02:00
## 4 Automático              CETESB Dados Primários 01/01/2014 03:00
## 5 Automático              CETESB Dados Primários 01/01/2014 04:00
## 6 Automático              CETESB Dados Primários 01/01/2014 05:00
## 7 Automático              CETESB Dados Primários 01/01/2014 06:00
##   CodigoEstação                NomeEstação              NomeParâmetro
## 2            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 3            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 4            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 5            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 6            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 7            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
##   UnidadedeMedida MediaHoraria MediaMovel Valido
## 2             ppb            9          -    Não
## 3             ppb            9          -    Sim
## 4             ppb            5          -    Sim
## 5             ppb            4          -    Sim
## 6             ppb            5          -    Sim
## 7             ppb            5          -    Sim</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(df2)</code></pre></div>
<pre><code>##      TipodeRede TipodeMonitoramento            Tipo       Data  Hora
## 8577 Automático              CETESB Dados Primários 01/01/2015 19:00
## 8578 Automático              CETESB Dados Primários 01/01/2015 20:00
## 8579 Automático              CETESB Dados Primários 01/01/2015 21:00
## 8580 Automático              CETESB Dados Primários 01/01/2015 22:00
## 8581 Automático              CETESB Dados Primários 01/01/2015 23:00
## 8582 Automático              CETESB Dados Primários 01/01/2015 24:00
##      CodigoEstação                NomeEstação              NomeParâmetro
## 8577            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 8578            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 8579            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 8580            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 8581            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 8582            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
##      UnidadedeMedida MediaHoraria MediaMovel Valido
## 8577             ppb            3          -    Sim
## 8578             ppb            8          -    Sim
## 8579             ppb           11          -    Sim
## 8580             ppb           11          -    Sim
## 8581             ppb           16          -    Sim
## 8582             ppb           NA          -    Sim</code></pre>
<p>Além desses comandos, vocês também pode utilizar a opção <strong>Import Dataset</strong> do Rstudio, permitindo que você tenha um “preview” dos dados, como no excel, mas melhor!</p>
<p>Para mais informações sobre importar dados no R, dê uma olha nesse <a href="https://www.rstudio.com/resources/webinars/importing-data-into-r/">webnário</a></p>
</div>
<div id="exportando-texto-com-write.table" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Exportando texto com <code>write.table</code></h3>
<p>Exportar é bem facil. Vamos dar uma olhada nos argumentos da função <code>write.table</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">args</span>(write.table)</code></pre></div>
<pre><code>## function (x, file = &quot;&quot;, append = FALSE, quote = TRUE, sep = &quot; &quot;, 
##     eol = &quot;\n&quot;, na = &quot;NA&quot;, dec = &quot;.&quot;, row.names = TRUE, col.names = TRUE, 
##     qmethod = c(&quot;escape&quot;, &quot;double&quot;), fileEncoding = &quot;&quot;) 
## NULL</code></pre>
<p>Se temos um data-frame com colunas de classe character, <code>quote = TRUE</code> quer dizer que o arquivo de texto resultante vai ter aspas nas colunas de caractere. Novamente, o argumento <code>sep</code> indica como podemos separar as colunas. Se você quiser abrir esses dados no excel, uma boa opção é utilizar os separadores “,”/“;”/&quot; “/”“, sendo o último o separador que indica o espaçamento criado pela tecla TAB.</p>
<p>Já o argumento <code>eol</code> quer dizer <em>end of line</em>, e é uma forma de dizer ao R que a linha acaba ali. Por padrão, a opção <code>row.names</code> vem com a opção TRUE, mas sempre coloque a opção FALSE, caso contrário, será adicionada uma coluna com os índices das linhas. O argumento <code>col.names</code> indica se você quer nomear as suas colunas, o que é sempre uma boa ideia.</p>
<p><strong>Exercício:</strong> Usando o conjunto de dados <code>mtcars</code> da base do R, vamos exportá-lo de uma forma que ele possa ser lido em algum Excel genérico. Não esqueça de usar o que foi ensinado acima.</p>
</div>
<div id="exportando-objetos-com-save" class="section level3">
<h3><span class="header-section-number">4.1.3</span> Exportando objetos com <code>save</code></h3>
<p>Podemos salvar objetos do R com o comando <code>save</code>, ele permite que você recarregue o objeto mais tarde.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">args</span>(save)</code></pre></div>
<pre><code>## function (..., list = character(), file = stop(&quot;&#39;file&#39; must be specified&quot;), 
##     ascii = FALSE, version = NULL, envir = parent.frame(), compress = isTRUE(!ascii), 
##     compression_level, eval.promises = TRUE, precheck = TRUE) 
## NULL</code></pre>
<p>Essa função salva o objeto com a extensão .rda sendo que para carregá-lo de volta usamos a função <code>load</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">args</span>(load)</code></pre></div>
<pre><code>## function (file, envir = parent.frame(), verbose = FALSE) 
## NULL</code></pre>
<p>Muito cuidado ao utilizar esse comando, pois podemos cometer alguns delizes, como trocar o nome do objeto. Veja esse exemplo abaixo:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Primeiro vamos ler os dados do dia 01/06/2016 para uma estação automática do INMET de Paracatu:</span>
paracatu &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file =</span> <span class="st">&quot;dados/paracatu.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>) <span class="co">#lendo como csv</span>

<span class="co"># Vamos dizer que queremos salvar apenas a coluna correspondente à temperatura máxima horária:</span>
paracatu_temp &lt;-<span class="st"> </span>paracatu<span class="op">$</span>temp_max  

<span class="co">#Agora vamos salvar o objeto do tipo numeric com o nome especificado:</span>
<span class="kw">save</span>(paracatu_temp, <span class="dt">file =</span> <span class="st">&quot;Temp_max.rda&quot;</span>)</code></pre></div>
<p>Passado um tempo, queremos acessar de volta esse objeto, mas não lembramos se salvamos a temperatura máxima ou mínima, vamos confiar que foi a mínima:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;Temp_min.rda&quot;</span>)</code></pre></div>
<p>E assim descobrimos que não era… O que nos ensina a sempre guardar na memória quais variáveis que salvamos no ambiente R. O bom dessa função é que ela permite salvar com tipos de compressão, por exemplo compress = “xz”.</p>
</div>
<div id="exportando-objetos-com-saverds" class="section level3">
<h3><span class="header-section-number">4.1.4</span> Exportando objetos com <code>saveRDS</code></h3>
<p>Esta é uma das minhas funçoes favoritas no R, veja só o porquê:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">saveRDS</span>(paracatu_temp, <span class="st">&quot;Temperatura.rds&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">frenteQ &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;Temperatura.rds&quot;</span>)</code></pre></div>
<p>Você pode salvar seu objeto R de forma serializada e compactada com o argumento <code>compress</code> e na hora de chamar o objeto de volta é só usar <code>readRDS</code> e colocar o nome que você quiser.</p>
</div>
<div id="processing_dfs" class="section level3">
<h3><span class="header-section-number">4.1.5</span> Processando nossa data-frame</h3>
<p>Existem inúmeros pacotes para organizar (Arrange) e modificar data frames. As mais conhecidas são provavelmente do universe <em>tidyverse</em> como o famoso pacote <em>dplyr</em>. Mas, neste curso vamos focar no <strong>base</strong>.</p>
<p>Vamos então revisar a classe de cada coluna do nosso data-frame com a função <code>sapply</code>, que será revisada em putro capítuo, mas lembre, qualquer dúvida é só usar <code>?sapply</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(df, class)</code></pre></div>
<pre><code>##          TipodeRede TipodeMonitoramento                Tipo 
##            &quot;factor&quot;            &quot;factor&quot;            &quot;factor&quot; 
##                Data                Hora       CodigoEstação 
##            &quot;factor&quot;            &quot;factor&quot;           &quot;integer&quot; 
##         NomeEstação       NomeParâmetro     UnidadedeMedida 
##            &quot;factor&quot;            &quot;factor&quot;            &quot;factor&quot; 
##        MediaHoraria          MediaMovel              Valido 
##           &quot;integer&quot;            &quot;factor&quot;            &quot;factor&quot;</code></pre>
<p>Quando trabalhamos com séries temporais, é importante ter a variável tempo reconhecida como “tempo”, especificamente como classe “POSIXct”, porém, a calsse do tipo Data é “factor” assim como a Hora, o que pode ser ruim. Então, vamos criar uma variável de tempo mais padronizada com o formato 2018-06-04 00:46:06.</p>
<p>Para isso temos que juntar as variáveis Data e Hora. Faremos isso numa nova varável chamada “tempo_char”“, adicionando-a diretamente no data frame com o cifrão DOLLAR”$“. Podemos fazer isso com as funções <code>paste</code> ou <code>paste0</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df<span class="op">$</span>tempo_char &lt;-<span class="st"> </span><span class="kw">paste</span>(df<span class="op">$</span>Data, df<span class="op">$</span>Hora)
<span class="kw">head</span>(df<span class="op">$</span>tempo_char)</code></pre></div>
<pre><code>## [1] &quot;01/01/2014 01:00&quot; &quot;01/01/2014 02:00&quot; &quot;01/01/2014 03:00&quot;
## [4] &quot;01/01/2014 04:00&quot; &quot;01/01/2014 05:00&quot; &quot;01/01/2014 06:00&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(df<span class="op">$</span>tempo_char)</code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Melhorou, mas ainda tem clase character.</p>
<p>Para converter a nossa classe para POSIXct podemos usar a função <code>as.POSIXct</code> (olhe<br />
<code>?as.POSIXct</code>). Seus argumentos são:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">args</span>(as.POSIXct)</code></pre></div>
<pre><code>## function (x, tz = &quot;&quot;, ...) 
## NULL</code></pre>
<p>Então, vamos criar outra variável tempo o formato POSIXct:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df<span class="op">$</span>tempo &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="dt">x =</span> df<span class="op">$</span>tempo_char, <span class="dt">tz =</span> <span class="st">&quot;Americas/Sao_Paulo&quot;</span>, 
                       <span class="dt">format =</span> <span class="st">&quot;%d/%m/%Y %H:%M&quot;</span>)
<span class="kw">head</span>(df<span class="op">$</span>tempo)</code></pre></div>
<pre><code>## [1] &quot;2014-01-01 01:00:00 Americas&quot; &quot;2014-01-01 02:00:00 Americas&quot;
## [3] &quot;2014-01-01 03:00:00 Americas&quot; &quot;2014-01-01 04:00:00 Americas&quot;
## [5] &quot;2014-01-01 05:00:00 Americas&quot; &quot;2014-01-01 06:00:00 Americas&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(df<span class="op">$</span>tempo)</code></pre></div>
<pre><code>## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<p>Agora, vamos a extrair os dias da semana do tempo, mes e dia juliano:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df<span class="op">$</span>weekdays &lt;-<span class="st"> </span><span class="kw">format</span>(df<span class="op">$</span>tempo, <span class="st">&quot;%A&quot;</span>)
<span class="kw">head</span>(df<span class="op">$</span>weekdays)</code></pre></div>
<pre><code>## [1] &quot;quarta&quot; &quot;quarta&quot; &quot;quarta&quot; &quot;quarta&quot; &quot;quarta&quot; &quot;quarta&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df<span class="op">$</span>mes &lt;-<span class="st"> </span><span class="kw">format</span>(df<span class="op">$</span>tempo, <span class="st">&quot;%B&quot;</span>)
<span class="kw">head</span>(df<span class="op">$</span>mes)</code></pre></div>
<pre><code>## [1] &quot;janeiro&quot; &quot;janeiro&quot; &quot;janeiro&quot; &quot;janeiro&quot; &quot;janeiro&quot; &quot;janeiro&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df<span class="op">$</span>diajuliano &lt;-<span class="st"> </span><span class="kw">julian</span>(df<span class="op">$</span>tempo)
<span class="kw">head</span>(df<span class="op">$</span>diajuliano)</code></pre></div>
<pre><code>## Time differences in days
## [1] 16071.04 16071.08 16071.12 16071.17 16071.21 16071.25</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df<span class="op">$</span>ano &lt;-<span class="st"> </span><span class="kw">format</span>(df<span class="op">$</span>tempo, <span class="st">&quot;%Y&quot;</span>)</code></pre></div>
<p>Pronto! Agora temos o tempo no formato que desejamos.</p>
<div id="aggregate" class="section level4">
<h4><span class="header-section-number">4.1.5.1</span> Aggregate</h4>
<p>Vamos a carregar o nosso data frame e daruma olhada nele:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(df)</code></pre></div>
<pre><code>##   TipodeRede TipodeMonitoramento            Tipo       Data  Hora
## 2 Automático              CETESB Dados Primários 01/01/2014 01:00
## 3 Automático              CETESB Dados Primários 01/01/2014 02:00
## 4 Automático              CETESB Dados Primários 01/01/2014 03:00
## 5 Automático              CETESB Dados Primários 01/01/2014 04:00
## 6 Automático              CETESB Dados Primários 01/01/2014 05:00
## 7 Automático              CETESB Dados Primários 01/01/2014 06:00
##   CodigoEstação                NomeEstação              NomeParâmetro
## 2            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 3            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 4            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 5            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 6            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 7            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
##   UnidadedeMedida MediaHoraria MediaMovel Valido       tempo_char
## 2             ppb            9          -    Não 01/01/2014 01:00
## 3             ppb            9          -    Sim 01/01/2014 02:00
## 4             ppb            5          -    Sim 01/01/2014 03:00
## 5             ppb            4          -    Sim 01/01/2014 04:00
## 6             ppb            5          -    Sim 01/01/2014 05:00
## 7             ppb            5          -    Sim 01/01/2014 06:00
##                 tempo weekdays     mes    diajuliano  ano
## 2 2014-01-01 01:00:00   quarta janeiro 16071.04 days 2014
## 3 2014-01-01 02:00:00   quarta janeiro 16071.08 days 2014
## 4 2014-01-01 03:00:00   quarta janeiro 16071.12 days 2014
## 5 2014-01-01 04:00:00   quarta janeiro 16071.17 days 2014
## 6 2014-01-01 05:00:00   quarta janeiro 16071.21 days 2014
## 7 2014-01-01 06:00:00   quarta janeiro 16071.25 days 2014</code></pre>
<p>Podemos calcular a média horaria por dia da semana:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dff &lt;-<span class="st"> </span><span class="kw">aggregate</span>(df<span class="op">$</span>MediaHoraria, <span class="dt">by =</span> <span class="kw">list</span>(df<span class="op">$</span>weekdays), sum, <span class="dt">na.rm =</span> T)
dff</code></pre></div>
<pre><code>##   Group.1     x
## 1 domingo 20327
## 2  quarta 40180
## 3  quinta 41199
## 4  sábado 32298
## 5 segunda 34057
## 6   sexta 42558
## 7   terça 37904</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(dff) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dias&quot;</span>, <span class="st">&quot;MediaHoraria&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dff<span class="op">$</span>sd &lt;-<span class="st"> </span><span class="kw">aggregate</span>(df<span class="op">$</span>MediaHoraria, 
                    <span class="dt">by =</span> <span class="kw">list</span>(df<span class="op">$</span>weekdays), 
                    sum, <span class="dt">na.rm =</span> T)<span class="op">$</span>x
dff</code></pre></div>
<pre><code>##      dias MediaHoraria    sd
## 1 domingo        20327 20327
## 2  quarta        40180 40180
## 3  quinta        41199 41199
## 4  sábado        32298 32298
## 5 segunda        34057 34057
## 6   sexta        42558 42558
## 7   terça        37904 37904</code></pre>
</div>
<div id="subset" class="section level4">
<h4><span class="header-section-number">4.1.5.2</span> Subset</h4>
<p>Como podemos escolher só o mês de janeiro??</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#[     LINHAS    ,  COLUNAS   ]</span>
<span class="kw">head</span>(df[df<span class="op">$</span>mes <span class="op">==</span><span class="st"> &quot;janeiro&quot;</span>, ]) <span class="co">#TODAS AS COLUNAS</span></code></pre></div>
<pre><code>##   TipodeRede TipodeMonitoramento            Tipo       Data  Hora
## 2 Automático              CETESB Dados Primários 01/01/2014 01:00
## 3 Automático              CETESB Dados Primários 01/01/2014 02:00
## 4 Automático              CETESB Dados Primários 01/01/2014 03:00
## 5 Automático              CETESB Dados Primários 01/01/2014 04:00
## 6 Automático              CETESB Dados Primários 01/01/2014 05:00
## 7 Automático              CETESB Dados Primários 01/01/2014 06:00
##   CodigoEstação                NomeEstação              NomeParâmetro
## 2            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 3            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 4            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 5            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 6            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
## 7            95 Cid.Universitária-USP-Ipen NOx (Óxidos de Nitrogênio)
##   UnidadedeMedida MediaHoraria MediaMovel Valido       tempo_char
## 2             ppb            9          -    Não 01/01/2014 01:00
## 3             ppb            9          -    Sim 01/01/2014 02:00
## 4             ppb            5          -    Sim 01/01/2014 03:00
## 5             ppb            4          -    Sim 01/01/2014 04:00
## 6             ppb            5          -    Sim 01/01/2014 05:00
## 7             ppb            5          -    Sim 01/01/2014 06:00
##                 tempo weekdays     mes    diajuliano  ano
## 2 2014-01-01 01:00:00   quarta janeiro 16071.04 days 2014
## 3 2014-01-01 02:00:00   quarta janeiro 16071.08 days 2014
## 4 2014-01-01 03:00:00   quarta janeiro 16071.12 days 2014
## 5 2014-01-01 04:00:00   quarta janeiro 16071.17 days 2014
## 6 2014-01-01 05:00:00   quarta janeiro 16071.21 days 2014
## 7 2014-01-01 06:00:00   quarta janeiro 16071.25 days 2014</code></pre>
<p>Só que agora temos só a média horária para esse mês, que retorna um vetor numérico:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(df)</code></pre></div>
<pre><code>##  [1] &quot;TipodeRede&quot;          &quot;TipodeMonitoramento&quot; &quot;Tipo&quot;               
##  [4] &quot;Data&quot;                &quot;Hora&quot;                &quot;CodigoEstação&quot;      
##  [7] &quot;NomeEstação&quot;         &quot;NomeParâmetro&quot;       &quot;UnidadedeMedida&quot;    
## [10] &quot;MediaHoraria&quot;        &quot;MediaMovel&quot;          &quot;Valido&quot;             
## [13] &quot;tempo_char&quot;          &quot;tempo&quot;               &quot;weekdays&quot;           
## [16] &quot;mes&quot;                 &quot;diajuliano&quot;          &quot;ano&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(df[df<span class="op">$</span>mes <span class="op">==</span><span class="st"> &quot;janeiro&quot;</span>, <span class="dv">10</span>]) </code></pre></div>
<pre><code>## [1] 9 9 5 4 5 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(df[df<span class="op">$</span>mes <span class="op">==</span><span class="st"> &quot;janeiro&quot;</span>, <span class="st">&quot;MediaHoraria&quot;</span>])</code></pre></div>
<pre><code>## [1] 9 9 5 4 5 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(df[df<span class="op">$</span>mes <span class="op">==</span><span class="st"> &quot;janeiro&quot;</span>, <span class="st">&quot;MediaHoraria&quot;</span>])</code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p>Dessa forma, vamos salvar nosso data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">saveRDS</span>(df, <span class="st">&quot;dados/df.rds&quot;</span>)</code></pre></div>
</div>
</div>
<div id="data.table-e-mais" class="section level3">
<h3><span class="header-section-number">4.1.6</span> Data.table e mais</h3>
<p>O data.table é um pacote que apresenta a classe <code>data.table</code>, que é como uma versão melhorada da classe <code>data-frame</code> O termo especifico é que <code>data-table</code> tem um “parentesco” (inherits) com a classe <code>data.frame</code></p>
<p>Vamos ver como funciona data.table lendo os dois arquivos e comparar quanto tempo demora cada um.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 &lt;-<span class="st"> </span><span class="kw">print</span>(<span class="kw">system.time</span>(<span class="kw">read.table</span>(<span class="st">&quot;dados/NOXIPEN2014.txt&quot;</span>, <span class="dt">h =</span> T)))</code></pre></div>
<pre><code>##    user  system elapsed 
##   0.070   0.001   0.070</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(data.table)
df2 &lt;-<span class="st"> </span><span class="kw">print</span>(<span class="kw">system.time</span>(<span class="kw">fread</span>(<span class="st">&quot;dados/NOXIPEN2014.txt&quot;</span>, <span class="dt">h =</span> T)))</code></pre></div>
<pre><code>##    user  system elapsed 
##   0.009   0.005   0.012</code></pre>
<p>Para isso usamos a função <code>fread</code>.</p>
</div>
</div>
<div id="tidyverse" class="section level2">
<h2><span class="header-section-number">4.2</span> Tidyverse</h2>
<p>Um método mais recente (e muito interessante!) de tratar data frames é usando os pacotes dentro do <a href="https://www.tidyverse.org/">Tidyverse</a>.<br />
Usando diversas funções dos pacotes <strong>readr</strong>, <strong>tidyr</strong> e <strong>dplyr</strong>, por exemplo, é possível ler e processar dados de uma maneira mais <em>user-friendly</em> devido à sintaxe das funções e de como elas podem ser usadas em conjunto.<br />
Note que muitas das funções usadas abaixo podem ser encontradas em Base ou em outros pacotes.</p>
<div id="importando-dados" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Importando dados</h3>
<p>Todas as funções de leitura possuem a mesma estrutura:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">read_<span class="op">*</span>(arquivo, 
       <span class="dt">col_names =</span> <span class="ot">TRUE</span>, 
       <span class="dt">col_types =</span> <span class="ot">NULL</span>, 
       <span class="dt">locale =</span> <span class="kw">default_locale</span>(), 
       <span class="dt">na =</span> <span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;NA&quot;</span>),
       <span class="dt">quoted_na =</span> <span class="ot">TRUE</span>, 
       <span class="dt">comment =</span> <span class="st">&quot;&quot;</span>, 
       <span class="dt">trim_ws =</span> <span class="ot">TRUE</span>, 
       <span class="dt">skip =</span> <span class="dv">0</span>, 
       <span class="dt">n_max =</span> <span class="ot">Inf</span>, 
       <span class="dt">guess_max =</span> <span class="kw">min</span>(<span class="dv">1000</span>, n_max), <span class="dt">progress =</span> <span class="kw">interactive</span>())</code></pre></div>
<p><em>Dica: Quando a descrição de uma função mostra os argumentos já definidos (<code>col_names = TRUE</code>), isso significa que esses são os valores padrão e que você não precisa escrever os argumentos se não quiser mudá-los</em></p>
<p>Assim, todas as funções de leitura só precisam do nome do arquivo!</p>
<p>Então como ler diferentes arquivos? Usando diferentes funções.</p>
<ul>
<li><code>read_csv</code> lê arquivos .csv <strong>separados por <span class="math inline">\(,\)</span></strong><br />
</li>
<li><code>read_csv2</code> lê arquivos .csv <strong>separados por <span class="math inline">\(;\)</span></strong><br />
</li>
<li><code>read_delim</code> lê arquivos <strong>com outros separadores</strong> (definidos com o argumento <code>delim</code>)<br />
</li>
<li><code>read_fwf</code> lê arquivos <strong>com delimitação fixa</strong> (definidos com o argumento <code>col_positions</code>)<br />
</li>
<li><code>read_xl</code> lê arquivos <strong>Excel</strong> (.xls e .xlsx)</li>
</ul>
</div>
<div id="leitura-processamento" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Leitura <code>%&gt;%</code> Processamento</h3>
<p>Existem funções de leitura e modificação de data frames. Muitas vezes, você precisa lidar com dados “brutos” e que precisam de um certo processamento antes de serem utilizados em cálculos e gráficos. Isso exige no mínimo duas funções em duas linhas de código (uma para ler e outra para modificar), mas em geral esse processo precisa de bem mais do que isso.</p>
<p>O operador <code>%&gt;%</code> (chamada de <em>pipe</em>) está dentro do pacote magnittr (dentro do Tidyverse) e é muito útil nesse processo! (<a href="https://www.datacamp.com/community/tutorials/pipe-r-tutorial">Leia um pouco sobre ele aqui</a>)</p>
<p>Como ele funciona?</p>
<blockquote>
<p>variável %&gt;% função1(., faz a modificação 1) %&gt;% função2(., faz a modificação 2) %&gt;% … funçãon(., faz a modificação n)</p>
</blockquote>
<p>O ponto (.) acima indica que a função será aplicada na versão da variável que chega nela.<br />
Em notação matemática, podemos dizer que <span class="math inline">\(x \ \ \%&gt;\% \ \ f(y) = f(x,y)\)</span>.<br />
Por exemplo, observe o código abaixo:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)

<span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">order</span>(., <span class="dt">decreasing =</span> T) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">paste</span>(., <span class="st">&quot;vezes&quot;</span>)</code></pre></div>
<pre><code>##  [1] &quot;10 vezes&quot; &quot;9 vezes&quot;  &quot;8 vezes&quot;  &quot;7 vezes&quot;  &quot;6 vezes&quot;  &quot;5 vezes&quot; 
##  [7] &quot;4 vezes&quot;  &quot;3 vezes&quot;  &quot;2 vezes&quot;  &quot;1 vezes&quot;</code></pre>
<p>O vetor (que não precisa necessariamente ser definido como uma variável) é primeiro ordenado de forma decrescente e, a partir dessa modificação, é transformado em um vetor de caracteres ao colar a string “vezes” a ele.</p>
<p>Uma forma de fazer isso sem usar <code>%&gt;%</code> seria:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(<span class="kw">order</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="dt">decreasing =</span> T), <span class="st">&quot;vezes&quot;</span>)</code></pre></div>
<pre><code>##  [1] &quot;10 vezes&quot; &quot;9 vezes&quot;  &quot;8 vezes&quot;  &quot;7 vezes&quot;  &quot;6 vezes&quot;  &quot;5 vezes&quot; 
##  [7] &quot;4 vezes&quot;  &quot;3 vezes&quot;  &quot;2 vezes&quot;  &quot;1 vezes&quot;</code></pre>
<p><span style="color:blue"><strong>Pergunta</strong>: Na sua opinião, qual é o código mais fácil e rápido de ser entendido?</span></p>
<p>Como isso pode ser aplicado a data frames?</p>
</div>
</div>
<div id="outros-tipos-de-dados" class="section level2">
<h2><span class="header-section-number">4.3</span> Outros Tipos de Dados</h2>
<div id="netcdf" class="section level3">
<h3><span class="header-section-number">4.3.1</span> NetCDF</h3>
<p>O NetCDF (Network Common Data Form) é um conjunto de bibliotecas de software e formatos de dados independentes de máquina e autodescritivos com suporte para criação, acesso e compartilhamento de dados científicos orientados a matrizes. Arquivos NetCDF (criado por essa biblioteca ou por programas que utilizam essa biblioteca) são arquivos compostos por dados, atributos e metadados.</p>
<p>O pacote <code>ncdf4</code> pode ser usado para acessar a essa biblioteca, os comandos abaixo instalam e carregam esse pacote:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;ncdf4&quot;) # instala o pacote</span>
<span class="kw">library</span>(<span class="st">&quot;ncdf4&quot;</span>)          <span class="co"># carrega o pacote</span>
<span class="kw">nc_version</span>()              <span class="co"># que retorna a versão da biblioteca</span></code></pre></div>
<pre><code>## [1] &quot;ncdf4_1.16_20170401&quot;</code></pre>
<p>Um exemplo de NetCDF:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wrf &lt;-<span class="st"> </span>ncdf4<span class="op">::</span><span class="kw">nc_open</span>(<span class="st">&quot;dados/met_em.d03.2016-01-10.nc&quot;</span>)</code></pre></div>
<p>O objeto <code>wrf</code> contém algumas informações sobre o conteúdo do arquivo, com um <code>print(wrf)</code> ou simplesmente <code>wrf</code> visualizamos o conteúdo do arquivo:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(wrf)
wrf</code></pre></div>
<p>Isso mostra o nome do arquivo (e versão da biblioteca usada para criar), número de variáveis (92 no arquivo de exemplo), uma descrição de cada variável (incluindo atributos) as dimensões (13 para esse arquivo) e os atributos globais.</p>
<p>Agora vamos abrir alguma variável:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(wrf<span class="op">$</span>var)                <span class="co"># print no nome de cada variavel</span>
TEMP &lt;-<span class="st"> </span>ncdf4<span class="op">::</span><span class="kw">ncvar_get</span>(wrf, <span class="st">&quot;TT&quot;</span>)  <span class="co"># escolho você picachu</span>
<span class="kw">class</span>(TEMP)</code></pre></div>
<p>Como o NetCDF é organizado para guardar matrizes (arrays), só sabemos que a variável <code>ST</code> é um array</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ncatt_get</span>(wrf,<span class="st">&quot;TT&quot;</span>) <span class="co"># ou ncatt_get(wrf,&quot;TT&quot;,verbose = T)</span>
<span class="kw">dim</span>(TEMP)</code></pre></div>
<p>praticamente a mesma informação do print anterior:</p>
<pre><code>float TT[west_east,south_north,num_metgrid_levels,Time]   
FieldType: 104
MemoryOrder: XYZ
units: K
description: Temperature
stagger: M
sr_x: 1
sr_y: 1</code></pre>
<p>como temos apenas 1 tempo essa dimensão é desconsiderada para simplificar.</p>
<p>A latitude de cada ponto de grade, assim como longitude níveis e tempo podem ser extraídas:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lat  &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(wrf, <span class="st">&quot;XLAT_M&quot;</span>)
lon  &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(wrf, <span class="st">&quot;XLONG_M&quot;</span>)
time &lt;-<span class="st"> </span><span class="kw">ncvar_get</span>(wrf, <span class="st">&quot;Times&quot;</span>)</code></pre></div>
<p>O metadado de Longitude:</p>
<pre><code>float XLONG_M[west_east,south_north,Time]   
FieldType: 104
MemoryOrder: XY 
units: degrees longitude
description: Longitude on mass grid
stagger: M
sr_x: 1
sr_y: 1</code></pre>
<p>Latitude:</p>
<pre><code>float XLAT_M[west_east,south_north,Time]   
FieldType: 104
MemoryOrder: XY 
units: degrees latitude
description: Latitude on mass grid
stagger: M
sr_x: 1
sr_y: 1</code></pre>
<p>e a altura:</p>
<pre><code>float GHT[west_east,south_north,num_metgrid_levels,Time]   
FieldType: 104
MemoryOrder: XYZ
units: m
description: Height
stagger: M
sr_x: 1
sr_y: 1</code></pre>
<p>Da mesma forma com que podemos acessar variáveis e atributos com <code>ncvar_get</code> e <code>ncatt_get</code>, podemos modificar estes valores com <code>ncvar_put</code> e <code>ncatt_put</code>. Outras operações como renomear (<code>ncvar_rename</code>) e trocar o valor de missval (<code>ncvar_change_missval</code>) também estão disponíveis.</p>
<p><em>DICA</em>: <code>ncatt_get</code> e <code>ncatt_put</code> acessam e alteram os atributos de váriaveis e também atributos globais do NetCDF usando o argumento <code>varid=0</code>.</p>
<p>Para salvar as alterações e/ou liberar o acesso ao arquivo use a função <code>nc_close</code> (ou a função <code>nc_sync</code> que sincroniza o NetCDF mas não fecha a conexão com o arquivo).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nc_close</span>(wrf) <span class="co"># ou nc_sync(wrf)</span></code></pre></div>
<p>Novas dimensões e também novas variáveis podem ser criadas com <code>ncvar_def</code> e <code>ncvar_add</code> em um arquivo aberto com permissão de leitura, como por exemplo:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wrf     &lt;-<span class="st"> </span><span class="kw">nc_open</span>(<span class="st">&quot;~/met_em.d03.2016-01-10.nc&quot;</span>, <span class="dt">write=</span><span class="ot">TRUE</span>)
extrema &lt;-<span class="st"> </span><span class="kw">ncvar_def</span>(<span class="dt">name =</span> <span class="st">&quot;Tex&quot;</span>,
                     <span class="dt">units =</span> <span class="st">&quot;K&quot;</span>,
                     <span class="dt">dim =</span> <span class="kw">list</span>(wrf<span class="op">$</span>dim<span class="op">$</span>west_east,
                                wrf<span class="op">$</span>dim<span class="op">$</span>south_north,
                                wrf<span class="op">$</span>dim<span class="op">$</span>Time),
                     <span class="dt">missval =</span> <span class="op">-</span><span class="dv">999</span>,
                     <span class="dt">longname =</span> <span class="st">&quot;temperatura extrema&quot;</span>)
<span class="kw">ncvar_add</span>(wrf, extrema)
<span class="kw">names</span>(wrf<span class="op">$</span>var)
<span class="kw">nc_close</span>(wrf)</code></pre></div>
<p>Se esse arquivo for aberto novamente vai conter 93 variáveis junto com a variável <code>Tex</code> da forma que definimos, caso queria os mesmos atributos que as demais é só usar a função <code>ncatt_get</code> na variável.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wrf &lt;-<span class="st"> </span><span class="kw">nc_open</span>(<span class="st">&quot;dados/met_em.d03.2016-01-10.nc&quot;</span>, <span class="dt">write =</span> T)
<span class="kw">print</span>(wrf)</code></pre></div>
<p>O pacote possue ainda funções mais específicas para a criação de arquivos em NetCDF como <code>nc_create</code>, funções que definem dimenções como <code>ncdim_def</code> e funções para colocar e tirar o arquivo de modo de definição <code>nc_redef</code> e <code>nc_enddef</code>.</p>
<p><em>DICA</em>: o NetCDF no R funciona de forma parecida com ouma lista ou data frame, podemos “ver” ou selecionar suas sub-partes (sub-sub-partes…) com “$” e TAB.</p>
</div>
<div id="dados-binarios" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Dados Binários</h3>
<p><strong>Ler dados binários no R</strong></p>
<p>Em meteorologia, frequentemente os dados estão em formato binário. A maior “dificuldade” em ler estes dados está em conhecer como eles foram gerados.</p>
<p>Repare que a função <code>readBin</code> requer vários argumentos para ler estes dados da forma correta:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">args</span>(readBin)</code></pre></div>
<pre><code>## function (con, what, n = 1L, size = NA_integer_, signed = TRUE, 
##     endian = .Platform$endian) 
## NULL</code></pre>
<p>Neste curso, o arquivo binário que vamos abrir como exemplo contém dados de temperatura de brilho obtidas com o satélite GOES-13 (informações em: <a href="https://disc.gsfc.nasa.gov/datasets/GPM_MERGIR_1/summary" class="uri">https://disc.gsfc.nasa.gov/datasets/GPM_MERGIR_1/summary</a>).</p>
<p>Lembrem-se de baixar o dado em: <a href="https://github.com/iagdevs/cursoR/tree/master/dados" class="uri">https://github.com/iagdevs/cursoR/tree/master/dados</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Ler o arquivo binário</span>
l1 &lt;-<span class="st"> </span><span class="kw">readBin</span>(<span class="st">&quot;dados/gs.140422.1900g.ch4&quot;</span>, 
              <span class="dt">what=</span><span class="st">&quot;int&quot;</span>, 
              <span class="dt">n =</span> <span class="dv">1349</span><span class="op">*</span><span class="dv">1613</span>,
              <span class="dt">size =</span> <span class="dv">2</span>)
<span class="kw">class</span>(l1)</code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p>Note que o argumento <code>endian</code> por default é <code>.Platform$endian</code>. Se rodarmos <code>.Platform$endian</code> no R obteremos a ordenação dos bytes (“big” ou “little”) utilizada pela plataforma que estamos usando.</p>
<p>Uma forma rápida para verificarmos os nossos dados é gráfica. Logo, que tal um plot?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(l1, <span class="dt">ncol=</span><span class="dv">1613</span>, <span class="dt">nrow=</span><span class="dv">1349</span>)
<span class="kw">class</span>(l2)</code></pre></div>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Vamos chamar o pacote cptcity para selecionar facilmente uma paleta de cores legal.</span>
<span class="kw">library</span>(cptcity)   
<span class="kw">image</span>(l2,
      <span class="dt">col =</span> <span class="kw">cpt</span>(<span class="kw">find_cpt</span>(<span class="st">&quot;sat&quot;</span>)[<span class="dv">8</span>]),
      <span class="dt">main =</span> <span class="st">&quot;Temperatura de brilho&quot;</span>) </code></pre></div>
<p><img src="cursoR_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<p>Tem algo estranho com esta imagem. O que é? (valendo um sticker).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raster, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)
l3 &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(l2[<span class="dv">1</span><span class="op">:</span><span class="dv">1349</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">1613</span>]),
                     <span class="dt">xmn=</span><span class="op">-</span><span class="fl">82.00</span>,
                     <span class="dt">ymn=</span><span class="op">-</span><span class="fl">44.96</span>,
                     <span class="dt">xmx=</span><span class="op">-</span><span class="fl">82.0</span>  <span class="op">+</span><span class="st"> </span>(<span class="fl">0.03593245</span><span class="op">*</span><span class="dv">1349</span>), 
                     <span class="dt">ymx=</span><span class="op">-</span><span class="fl">44.96</span> <span class="op">+</span><span class="st"> </span>(<span class="fl">0.03593245</span><span class="op">*</span><span class="dv">1613</span>),
                     <span class="dt">crs =</span> <span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:4326&quot;</span>))
<span class="kw">class</span>(l3)</code></pre></div>
<pre><code>## [1] &quot;RasterLayer&quot;
## attr(,&quot;package&quot;)
## [1] &quot;raster&quot;</code></pre>
<p>O capítulo geoespacial será visto no final deste curso. Porém, nesta etapa vamos usar o pacote <code>raster</code> somente para analisar se os dados binários foram lidos corretamente.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sp<span class="op">::</span><span class="kw">spplot</span>(((l3 <span class="op">+</span><span class="st"> </span><span class="dv">75</span>)<span class="op">/</span><span class="dv">100</span>)<span class="op">-</span><span class="dv">273</span>, <span class="co"># Estas correções são necessárias. Veja: http://www.cpc.ncep.noaa.gov/products/global_precip/html/README</span>
           <span class="dt">col.regions =</span> <span class="kw">cpt</span>(<span class="kw">find_cpt</span>(<span class="st">&quot;sat&quot;</span>)[<span class="dv">8</span>]),
           <span class="dt">at =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">80</span>,<span class="dv">0</span>,<span class="dv">1</span>),
           <span class="dt">main =</span> <span class="st">&quot;Temperatura de brilho (ºC)&quot;</span>) </code></pre></div>
<p><img src="cursoR_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<p><strong>Escrever dados binários no R</strong></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="plotando.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/iagdevs/cursoR/edit/master/03-import_export.Rmd",
"text": "Edit"
},
"download": ["cursoR.pdf", "cursoR.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
